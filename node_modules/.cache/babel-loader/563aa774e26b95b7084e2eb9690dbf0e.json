{"ast":null,"code":"var _jsxFileName = \"/home/neha/exq-ico-1/src/components/header/Accountmodal.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useCallback } from \"react\";\nimport Web3 from \"web3\";\nimport { connect } from \"react-redux\";\nimport { accountUpdate } from \"./../../redux/actions\";\nimport { Button } from \"reactstrap\";\nimport Web3Modal from \"web3modal\";\nimport WalletConnectProvider from \"@walletconnect/web3-provider\";\nimport detectEthereumProvider from \"@metamask/detect-provider\";\nimport GeneralModal from \"./wrongNetworkModal\";\nimport \"../header.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nfunction initWeb3(provider) {\n  const web3 = new Web3(provider);\n  web3.eth.extend({\n    methods: [{\n      name: \"chainId\",\n      call: \"eth_chainId\",\n      outputFormatter: web3.utils.hexToNumber\n    }]\n  });\n  return web3;\n}\n\nconst AccountModal = props => {\n  _s();\n\n  const [currentAccount, setCurrentAccount] = useState(null);\n  const [wrongNetwork, setWrongNetwork] = useState(false);\n  let web3Modal = null;\n  let web3 = null;\n  let provider = null; // to initilize the web3Modal\n\n  const init = async () => {\n    const providerOptions = {\n      walletconnect: {\n        package: WalletConnectProvider,\n        options: {\n          infuraId: \"c3f6ce1953e4470191a8d12b8ba92672\",\n          rpcUrl: process.env.REACT_APP_RPC_URL\n        }\n      }\n    };\n    web3Modal = new Web3Modal({\n      network: process.env.REACT_APP_NETWORK,\n      cacheProvider: false,\n      providerOptions: providerOptions\n    });\n    provider = await detectEthereumProvider();\n  };\n\n  init();\n  useEffect(() => {\n    async function update() {\n      if (window.sessionStorage.getItem(\"selected_account\") != null) {\n        setCurrentAccount(window.sessionStorage.getItem(\"selected_account\"));\n\n        if (provider) {\n          web3 = await initWeb3(provider);\n          props.dispatch(accountUpdate({\n            account: window.sessionStorage.getItem(\"selected_account\")\n          }));\n        }\n      }\n    }\n\n    update();\n  }, [window.sessionStorage.getItem(\"selected_Account\"), web3, provider]); // action on connect wallet button\n\n  const onConnect = async () => {\n    //Detect Provider\n    try {\n      provider = await web3Modal.connect();\n\n      if (provider.open) {\n        await provider.open();\n        web3 = await initWeb3(provider);\n        web3.eth.getAccounts(console.log);\n      }\n\n      window.sessionStorage.setItem(\"Provider\", provider);\n\n      if (!provider) {\n        console.log(\"no provider found\");\n      } else {\n        web3 = new Web3(provider);\n        await ConnectWallet();\n      }\n\n      const chainId = await web3.eth.net.getId();\n\n      if (chainId.toString() !== process.env.REACT_APP_CHAIN_ID) {\n        setWrongNetwork(true);\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  }; // connect wallet\n\n\n  const ConnectWallet = async () => {\n    if (\"caches\" in window) {\n      caches.keys().then(names => {\n        // Delete all the cache files\n        names.forEach(name => {\n          caches.delete(name);\n        });\n      });\n    }\n\n    try {\n      const chainId = await web3.eth.net.getId();\n\n      if (chainId.toString() !== process.env.REACT_APP_CHAIN_ID) {\n        console.log(\"Wrong network\");\n        setWrongNetwork(true);\n        props.dispatch(accountUpdate({\n          account: null\n        }));\n      } else {\n        // Get list of accounts of the connected wallet\n        setWrongNetwork(false);\n        const accounts = await web3.eth.getAccounts(); // MetaMask does not give you all accounts, only the selected account\n\n        window.sessionStorage.setItem(\"selected_account\", accounts[0]);\n        const chainId = await web3.eth.net.getId();\n        props.dispatch(accountUpdate({\n          account: accounts[0]\n        }));\n        setCurrentAccount(accounts[0]);\n        console.log(\"connected Account\", accounts[0]);\n      }\n    } catch (error) {\n      if (error.message) {\n        console.log(\"error\", error.message);\n      }\n    }\n  }; //  disconnect wallet\n\n\n  const onDisconnect = useCallback(async () => {\n    if (!web3) {\n      window.sessionStorage.removeItem(\"selected_account\");\n    }\n\n    if (web3) {\n      const chainId = await web3.eth.net.getId();\n      props.dispatch(accountUpdate({\n        account: null\n      }));\n    }\n\n    window.sessionStorage.removeItem(\"selected_account\");\n    window.sessionStorage.removeItem(\"Provider\");\n    await setCurrentAccount(null);\n    if (web3Modal) await web3Modal.clearCachedProvider();\n    web3Modal = null;\n\n    if (web3 && web3.currentProvider && web3.currentProvider.close) {\n      await web3.currentProvider.disconnect();\n    }\n\n    if (\"caches\" in window) {\n      caches.keys().then(names => {\n        // Delete all the cache files\n        names.forEach(name => {\n          caches.delete(name);\n        });\n      });\n      if (!wrongNetwork) window.location.reload(true);\n    }\n  }, [currentAccount]);\n  useEffect(() => {\n    console.log(\"provider\", provider);\n\n    if (provider) {\n      provider.on(\"chainChanged\", async _chainId => {\n        const chainId = parseInt(_chainId, 16);\n\n        if (chainId.toString() !== process.env.REACT_APP_CHAIN_ID) {\n          if (currentAccount) console.log(\"Wrong Network first\");\n          setWrongNetwork(true);\n          props.dispatch(accountUpdate({\n            account: null\n          }));\n          onDisconnect();\n        } else {\n          setWrongNetwork(false);\n          props.dispatch(accountUpdate({\n            account: currentAccount\n          }));\n        }\n      });\n    }\n  }, [onDisconnect]); // function to detect account change\n\n  useEffect(() => {\n    if (provider) {\n      provider.on(\"accountsChanged\", async function (accounts) {\n        const id = await provider.request({\n          method: \"eth_chainId\"\n        });\n        const chainId = parseInt(id, 16);\n        console.log(\"Account changed\", accounts[0]);\n\n        if (chainId.toString() == process.env.REACT_APP_CHAIN_ID && currentAccount) {\n          setCurrentAccount(accounts[0]);\n          console.log(\"Account changed\", accounts[0]);\n          window.sessionStorage.removeItem(\"selected_account\");\n          window.sessionStorage.setItem(\"selected_account\", accounts[0]);\n          props.dispatch(accountUpdate({\n            account: accounts[0]\n          }));\n        } else if (chainId.toString() != process.env.REACT_APP_CHAIN_ID) {\n          console.log(\"Wrong Network\");\n          setWrongNetwork(true);\n          props.dispatch(accountUpdate({\n            account: null\n          }));\n          window.sessionStorage.removeItem(\"selected_account\");\n          setCurrentAccount(null);\n          await onDisconnect();\n        }\n      });\n    }\n  }, [currentAccount]); // function to detect network change\n\n  useEffect(() => {\n    async function updateAccount() {\n      if (provider) {\n        window.sessionStorage.setItem(\"selected_account\", currentAccount);\n        props.dispatch(accountUpdate({\n          account: currentAccount\n        }));\n      }\n    }\n\n    if (currentAccount) {\n      updateAccount();\n    }\n  }, [currentAccount]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(Button, {\n      className: \"connect-btn\",\n      onClick: currentAccount ? onDisconnect : onConnect,\n      children: window.sessionStorage.getItem(\"selected_account\") ? window.sessionStorage.getItem(\"selected_account\").slice(0, 5) + \"...\" + window.sessionStorage.getItem(\"selected_account\").slice(37, 42) : \"CONNECT WALLET\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 266,\n      columnNumber: 7\n    }, this)\n  }, void 0, false);\n};\n\n_s(AccountModal, \"a5phJlKU1PyGw5hae9hnDF6TkI4=\");\n\n_c = AccountModal;\n\nconst mapStateToProps = state => {\n  return {\n    account: state.account\n  };\n};\n\nexport default connect(mapStateToProps)(AccountModal);\n\nvar _c;\n\n$RefreshReg$(_c, \"AccountModal\");","map":{"version":3,"sources":["/home/neha/exq-ico-1/src/components/header/Accountmodal.js"],"names":["React","useState","useEffect","useCallback","Web3","connect","accountUpdate","Button","Web3Modal","WalletConnectProvider","detectEthereumProvider","GeneralModal","initWeb3","provider","web3","eth","extend","methods","name","call","outputFormatter","utils","hexToNumber","AccountModal","props","currentAccount","setCurrentAccount","wrongNetwork","setWrongNetwork","web3Modal","init","providerOptions","walletconnect","package","options","infuraId","rpcUrl","process","env","REACT_APP_RPC_URL","network","REACT_APP_NETWORK","cacheProvider","update","window","sessionStorage","getItem","dispatch","account","onConnect","open","getAccounts","console","log","setItem","ConnectWallet","chainId","net","getId","toString","REACT_APP_CHAIN_ID","error","caches","keys","then","names","forEach","delete","accounts","message","onDisconnect","removeItem","clearCachedProvider","currentProvider","close","disconnect","location","reload","on","_chainId","parseInt","id","request","method","updateAccount","slice","mapStateToProps","state"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useCallback } from \"react\";\nimport Web3 from \"web3\";\nimport { connect } from \"react-redux\";\nimport { accountUpdate } from \"./../../redux/actions\";\nimport { Button } from \"reactstrap\";\nimport Web3Modal from \"web3modal\";\nimport WalletConnectProvider from \"@walletconnect/web3-provider\";\nimport detectEthereumProvider from \"@metamask/detect-provider\";\nimport GeneralModal from \"./wrongNetworkModal\";\nimport \"../header.css\";\n\nfunction initWeb3(provider) {\n  const web3 = new Web3(provider);\n\n  web3.eth.extend({\n    methods: [\n      {\n        name: \"chainId\",\n        call: \"eth_chainId\",\n        outputFormatter: web3.utils.hexToNumber,\n      },\n    ],\n  });\n\n  return web3;\n}\n\nconst AccountModal = (props) => {\n  const [currentAccount, setCurrentAccount] = useState(null);\n  const [wrongNetwork, setWrongNetwork] = useState(false);\n  let web3Modal = null;\n  let web3 = null;\n  let provider = null;\n\n  // to initilize the web3Modal\n\n  const init = async () => {\n    const providerOptions = {\n      walletconnect: {\n        package: WalletConnectProvider,\n        options: {\n          infuraId: \"c3f6ce1953e4470191a8d12b8ba92672\",\n          rpcUrl: process.env.REACT_APP_RPC_URL,\n        },\n      },\n    };\n\n    web3Modal = new Web3Modal({\n      network: process.env.REACT_APP_NETWORK,\n      cacheProvider: false,\n      providerOptions: providerOptions,\n    });\n    provider = await detectEthereumProvider();\n  };\n\n  init();\n\n  useEffect(() => {\n    async function update() {\n      if (window.sessionStorage.getItem(\"selected_account\") != null) {\n        setCurrentAccount(window.sessionStorage.getItem(\"selected_account\"));\n        if (provider) {\n          web3 = await initWeb3(provider);\n          props.dispatch(\n            accountUpdate({\n              account: window.sessionStorage.getItem(\"selected_account\"),\n            })\n          );\n        }\n      }\n    }\n\n    update();\n  }, [window.sessionStorage.getItem(\"selected_Account\"), web3, provider]);\n  // action on connect wallet button\n\n  const onConnect = async () => {\n    //Detect Provider\n    try {\n      provider = await web3Modal.connect();\n      if (provider.open) {\n        await provider.open();\n        web3 = await initWeb3(provider);\n        web3.eth.getAccounts(console.log);\n      }\n      window.sessionStorage.setItem(\"Provider\", provider);\n      if (!provider) {\n        console.log(\"no provider found\");\n      } else {\n        web3 = new Web3(provider);\n        await ConnectWallet();\n      }\n      const chainId = await web3.eth.net.getId();\n\n      if (chainId.toString() !== process.env.REACT_APP_CHAIN_ID) {\n        setWrongNetwork(true);\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  // connect wallet\n\n  const ConnectWallet = async () => {\n    if (\"caches\" in window) {\n      caches.keys().then((names) => {\n        // Delete all the cache files\n        names.forEach((name) => {\n          caches.delete(name);\n        });\n      });\n    }\n    try {\n      const chainId = await web3.eth.net.getId();\n\n      if (chainId.toString() !== process.env.REACT_APP_CHAIN_ID) {\n        console.log(\"Wrong network\");\n        setWrongNetwork(true);\n        props.dispatch(\n          accountUpdate({\n            account: null,\n          })\n        );\n      } else {\n        // Get list of accounts of the connected wallet\n        setWrongNetwork(false);\n        const accounts = await web3.eth.getAccounts();\n\n        // MetaMask does not give you all accounts, only the selected account\n        window.sessionStorage.setItem(\"selected_account\", accounts[0]);\n        const chainId = await web3.eth.net.getId();\n        props.dispatch(\n          accountUpdate({\n            account: accounts[0],\n          })\n        );\n        setCurrentAccount(accounts[0]);\n        console.log(\"connected Account\", accounts[0]);\n      }\n    } catch (error) {\n      if (error.message) {\n        console.log(\"error\", error.message);\n      }\n    }\n  };\n\n  //  disconnect wallet\n\n  const onDisconnect = useCallback(async () => {\n    if (!web3) {\n      window.sessionStorage.removeItem(\"selected_account\");\n    }\n    if (web3) {\n      const chainId = await web3.eth.net.getId();\n      props.dispatch(\n        accountUpdate({\n          account: null,\n        })\n      );\n    }\n    window.sessionStorage.removeItem(\"selected_account\");\n    window.sessionStorage.removeItem(\"Provider\");\n    await setCurrentAccount(null);\n    if (web3Modal) await web3Modal.clearCachedProvider();\n    web3Modal = null;\n    if (web3 && web3.currentProvider && web3.currentProvider.close) {\n      await web3.currentProvider.disconnect();\n    }\n    if (\"caches\" in window) {\n      caches.keys().then((names) => {\n        // Delete all the cache files\n        names.forEach((name) => {\n          caches.delete(name);\n        });\n      });\n      if (!wrongNetwork) window.location.reload(true);\n    }\n  }, [currentAccount]);\n\n  useEffect(() => {\n    console.log(\"provider\", provider);\n    if (provider) {\n      provider.on(\"chainChanged\", async (_chainId) => {\n        const chainId = parseInt(_chainId, 16);\n\n        if (chainId.toString() !== process.env.REACT_APP_CHAIN_ID) {\n          if (currentAccount) console.log(\"Wrong Network first\");\n          setWrongNetwork(true);\n          props.dispatch(\n            accountUpdate({\n              account: null,\n            })\n          );\n          onDisconnect();\n        } else {\n          setWrongNetwork(false);\n          props.dispatch(\n            accountUpdate({\n              account: currentAccount,\n            })\n          );\n        }\n      });\n    }\n  }, [onDisconnect]);\n\n  // function to detect account change\n\n  useEffect(() => {\n    if (provider) {\n      provider.on(\"accountsChanged\", async function (accounts) {\n        const id = await provider.request({ method: \"eth_chainId\" });\n        const chainId = parseInt(id, 16);\n        console.log(\"Account changed\", accounts[0]);\n        if (\n          chainId.toString() == process.env.REACT_APP_CHAIN_ID &&\n          currentAccount\n        ) {\n          setCurrentAccount(accounts[0]);\n          console.log(\"Account changed\", accounts[0]);\n          window.sessionStorage.removeItem(\"selected_account\");\n          window.sessionStorage.setItem(\"selected_account\", accounts[0]);\n          props.dispatch(\n            accountUpdate({\n              account: accounts[0],\n            })\n          );\n        } else if (chainId.toString() != process.env.REACT_APP_CHAIN_ID) {\n          console.log(\"Wrong Network\");\n          setWrongNetwork(true);\n          props.dispatch(\n            accountUpdate({\n              account: null,\n            })\n          );\n          window.sessionStorage.removeItem(\"selected_account\");\n          setCurrentAccount(null);\n          await onDisconnect();\n        }\n      });\n    }\n  }, [currentAccount]);\n\n  // function to detect network change\n\n  useEffect(() => {\n    async function updateAccount() {\n      if (provider) {\n        window.sessionStorage.setItem(\"selected_account\", currentAccount);\n\n        props.dispatch(\n          accountUpdate({\n            account: currentAccount,\n          })\n        );\n      }\n    }\n    if (currentAccount) {\n      updateAccount();\n    }\n  }, [currentAccount]);\n\n  return (\n    <>\n      <Button\n        className=\"connect-btn\"\n        onClick={currentAccount ? onDisconnect : onConnect}\n      >\n        {window.sessionStorage.getItem(\"selected_account\")\n          ? window.sessionStorage.getItem(\"selected_account\").slice(0, 5) +\n          \"...\" +\n          window.sessionStorage.getItem(\"selected_account\").slice(37, 42)\n          : \"CONNECT WALLET\"}\n      </Button>\n\n    </>\n  );\n};\nconst mapStateToProps = (state) => {\n  return {\n    account: state.account,\n  };\n};\n\nexport default connect(mapStateToProps)(AccountModal);\n"]},"metadata":{},"sourceType":"module"}